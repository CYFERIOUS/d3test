{"version":3,"sources":["pyramidChart.js","donutChart.js","mapChart.js"],"names":["pyramidChart","pyramidFrame","restrict","scope","data","templateUrl","controller","controllerAs","pyramidCtrl","$scope","$element","translation","x","y","formatNumberPiramide","n","d3","format","replace","piram_rural","$","document","ready","csv","error","datosCSV","dataCols","max","d","map","key","reduce","p","v","parseInt","total","sum","Total","forEach","Edad","push","edad","rango_edad","total_hombres","Hombres","total_mujeres","Mujeres","etn_hombres","etn_Hombres","etn_mujeres","etn_Mujeres","etn","grafico","elem","dibujarEdad","posicion","es_etn","espacioEtiquetasY","value","mujBarWidth","mujBars","svg","append","attr","bar","offsetY","anchoBarra","transition","duration","mujBarsText","puntoEdad","text","homBarsWidth","homBars","puntoCentral","homBarsText","txt","etiedad","selectAll","remove","pixelesAncho","pixelesAlto","length","select","scale","linear","domain","range","i","donutChart","donutFrame","donutCtrl","json","console","warn","c3","generate","bindto","size","width","height","columns","type","donut","label","ratio","id","tooltip","show","title","legend","item","onclick","mapChart","mapFrame","mapCtrl","log","app","angular","module","directive","$inject"],"mappings":"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","file":"../js/d3.min.js","sourcesContent":["\r\nvar app = angular.module('maps',[]);\r\napp.directive('pyramidChart',pyramidChart).controller('pyramidCtrl',pyramidCtrl);\r\n\r\n\r\nfunction pyramidChart(){\r\n\r\n\tvar pyramidFrame = {\r\n\r\n\t\trestrict:'A',\r\n\t\tscope:{\r\n\r\n\t\t\tdata: '@',\r\n\t\t\t//grafico:'@',\r\n\t\t\t//total:'@',\r\n\t\t\t//etn: '@',\r\n\r\n\t\t},\r\n\t\ttemplateUrl:'../directives/pyramid-chart.html',\r\n\t\tcontroller:'pyramidCtrl',\r\n\t\tcontrollerAs:'pyrmd',\r\n\r\n\t};\r\n\r\n\treturn pyramidFrame;\r\n\r\n};\r\n\r\npyramidCtrl.$inject = ['$scope','$element'];\r\nfunction pyramidCtrl($scope,$element){\r\n\r\n\t\r\n\r\n\t//.log($scope.data);\r\n\r\nvar piramTitles={\r\n\ttotal:'DistribuciÃ³n (%) de los productores residentes en el Ã¡rea rural dispersa censada, segÃºn edad y sexo.',\r\n\tetn:'ParticipaciÃ³n (%) de los productores residentes en el Ã¡rea rural dispersa censada, segÃºn edad y sexo en territorio de grupos Ã©tnicos.'\r\n\t};\r\nvar piram_rural = {};\r\n$(document).ready(function(){\r\n    /** Total ÃƒÂ¡rea rural dispersa censada  */\r\n    d3.csv($scope.data,function (error,datosCSV) {\r\n\tvar dataCols = ['Hombres','Mujeres','etn_Hombres','etn_Mujeres'];\r\n\tpiram_rural.max = d3.max(datosCSV, function(d){\r\n\t    return dataCols.map(function(key){return d[key]}).reduce(function(p,v){return parseInt(p) > parseInt(v) ? parseInt(p):parseInt(v)})\r\n\t});\r\n\tpiram_rural.total = d3.sum(datosCSV, function(d){return d.Total});\r\n\tpiram_rural.data = [];\r\n        datosCSV.forEach(function (Edad) {\r\n            piram_rural.data.push({\r\n                edad: parseInt(Edad),\r\n                rango_edad: Edad.Edad,\r\n                total_hombres: parseInt(Edad.Hombres),\r\n\t\ttotal_mujeres: parseInt(Edad.Mujeres),\r\n\t\ttotal: parseInt(Edad.Hombres) + parseInt(Edad.Mujeres),\r\n\t\tetn_hombres: parseInt(Edad.etn_Hombres),\r\n\t\tetn_mujeres: parseInt(Edad.etn_Mujeres),\r\n\t\tetn: parseInt(Edad.etn_Hombres) + parseInt(Edad.etn_Mujeres)\r\n\t\t\r\n\t    });\r\n        });\r\n\t    //document.getElementById('piramide-total').innerHTML = locale_esCo.numberFormat(',')(piram_rural.total);\r\n        //document.getElementsByName(\"total-nacional\")[0].click();      \r\n    });\r\n});\r\n/** PirÃƒÂ¡mide */\r\n$scope.grafico = function(elem){\r\n   // function grafico(elem){\r\n\t\r\n    // Borrar grÃ¡fico anterior, para simular la animaciÃ³n\r\n    d3.selectAll(\"svg\").remove();\r\n    //d3.selectAll($element[0]).html($element);\r\n    //document.getElementById('piramide-title').innerHTML ='';\r\n    // GrÃƒÂ¡fico SVG\r\n    var postext = 580;\r\n    var postext2 = 55;\r\n    var etiedad = 340;\r\n    var bar = 380;\r\n    var pixelesAncho = 720;\r\n    var puntoCentral = pixelesAncho / 3;\r\n    var puntoEdad = puntoCentral * 2 - 50;\r\n    var anchoBarra = 18;\r\n    var offsetY = 25;\r\n    var pixelesAlto = piram_rural.data.length * offsetY;\r\n    //document.getElementById('piramide-title').innerHTML = piramTitles[elem.value];\r\n    var svg = d3.select($element[0]).append(\"svg\")\r\n        .attr('height', pixelesAlto)\r\n        .attr('width', pixelesAncho)\r\n        .attr('class', 'piramide');\r\n   //d3.selectAll(\"svg\").remove();\r\n    // Escala x para tamaÃƒÂ±o de barras\r\n    var x = d3.scale\r\n        .linear()\r\n        .domain([0, piram_rural.max/piram_rural.total])\r\n        .range([0, puntoCentral]);\r\n    // Dibujado por rango de edad\r\n    piram_rural.data.forEach(function (d, i) {\r\n        dibujarEdad(d, i);\r\n    });\r\n    function dibujarEdad(data, posicion, es_etn) {\r\n        var espacioEtiquetasX = 5;\r\n        var espacioEtiquetasY = 15;\r\n\tvar total_hombres = data[elem.value+'_hombres'];\r\n\tvar total_mujeres = data[elem.value+'_mujeres'];\r\n\t\r\n        // barra mujeres\r\n\tvar mujBarWidth = x(total_mujeres/piram_rural.total);\r\n\tvar mujBars = svg.append('rect')\r\n            .attr('x', bar)\r\n            .attr('y', posicion * offsetY)\r\n\t    .attr('width',0)\r\n            .attr('height', anchoBarra)\r\n            .attr('class', 'barraMujeres');        \r\n\tmujBars.transition()\r\n            .attr('width', mujBarWidth)\r\n\t    .duration(2000);\r\n\r\n        var mujBarsText = svg.append('text')\r\n            .attr('x',puntoEdad-45)\r\n            .attr('y', (posicion * offsetY) + espacioEtiquetasY)\r\n            .attr('class', 'etiquetaMujeres')\r\n            .text(formatNumberPiramide(total_mujeres/piram_rural.total));\r\n\tmujBarsText.transition()\r\n\t    .attr('x',puntoEdad-45+mujBarWidth)\r\n\t    .duration(2000);\r\n        // barra hombres\r\n\tvar homBarsWidth = x(total_hombres/piram_rural.total);\r\n\tvar homBars = svg.append('rect')\r\n            .attr('x', puntoCentral-60)// - x(total_hombres))\r\n            .attr('y', posicion * offsetY)\r\n            .attr('width', 0)\r\n\t// Hack: 2*puntoCentral, need to change to a proper way\r\n\t    .attr('transform', translation(2*puntoCentral, 0) + ' scale(-1,1)') \r\n            .attr('height', anchoBarra)\r\n            .attr('class', 'barraHombres');\r\n        homBars.transition()\r\n            .attr('width', homBarsWidth)\r\n\t    .duration(2000);\r\n\r\n        var homBarsText = svg.append('text')\r\n\t    .attr('x',puntoCentral+20)\r\n            .attr('y', (posicion * offsetY) + espacioEtiquetasY)\r\n            .attr('class', 'etiquetaHombres')\r\n\t    .text(formatNumberPiramide(total_hombres/piram_rural.total));\r\n\thomBarsText.transition()\r\n\t    .attr('x', puntoCentral+20-homBarsWidth)\r\n\t    .duration(2000);\r\n        // etiqueta rango de edades\r\n        var txt = data.rango_edad;\r\n        svg.append('text')\r\n            .attr('x', etiedad)\r\n            .attr('y', (posicion * offsetY) + espacioEtiquetasY)\r\n\t    .attr('text-anchor','middle')\r\n            .attr('class', 'etiquetaEdad')\r\n            .text(txt);\r\n    }\r\n}\r\n// so sick of string concatenation for translations\r\nfunction translation(x,y) {\r\n    return 'translate(' + x + ',' + y + ')';\r\n}\r\n\r\nfunction formatNumberPiramide(n){\r\n    return d3.format('.1%')(n).replace('.',',');\r\n}\r\n  }","\r\napp.directive('donutChart',donutChart).controller('donutCtrl',donutCtrl);\r\ndonutCtrl.$inject = ['$scope','$element'];\r\n\r\nfunction donutChart(){\r\n\r\n\tvar donutFrame = {\r\n\r\n\t\trestrict:'A',\r\n\t\tscope:{\r\n\r\n\t\t\tdata: '@'\r\n\t\t},\r\n\t\tcontroller:'donutCtrl',\r\n\r\n\t};\r\n\r\n\treturn donutFrame;\r\n\r\n};\r\n\r\nfunction donutCtrl($scope,$element){\r\n\t\t\r\n\t\td3.json($scope.data, function(error, json) {\r\n\t\t\t\tif (error) return console.warn(error);\r\n\t\t\t\tvar data = json;\r\n\t\t\t\tvar chart = c3.generate({\r\n\t\t\t\t\tbindto: $element[0],\r\n\t\t\t\t\tsize:{width:600,height:600},\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tcolumns: json,\r\n\t\t\t\t\t\ttype : 'donut'\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdonut:{label:{\r\n\t\t\t\t\t\tformat: function (value, ratio, id) {\r\n\t\t\t\t\t\t\treturn d3.format('.1%')(ratio).replace('.',',');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}},\r\n\t\t\t\t\ttooltip:{show: false},\r\n\t\t\t\t\ttitle: \"pobreza por el IPM Ajustado\",\r\n\t\t\t\t\tlegend:{item:{onclick:function(id){}}}\r\n\t\t\t\t});\r\n\r\n\r\n\t\t});\r\n}\r\n\r\n","app.directive('mapChart',mapChart).controller('mapCtrl',mapCtrl);\r\n\r\n\r\nfunction mapChart(){\r\n\r\n\tvar mapFrame = {\r\n\r\n\t\trestrict:'A',\r\n\t\tscope:{\r\n\r\n\t\t\tdata: '@'\r\n\t\t},\r\n\t\tcontroller:'mapCtrl',\r\n\r\n\t};\r\n\r\n\treturn mapFrame;\r\n\r\n};\r\nmapCtrl.$inject = ['$scope','$element'];\r\nfunction mapCtrl($scope,$element){\r\n\r\n\tconsole.log($scope.data);\r\n\t\t\r\n\r\n}"]}